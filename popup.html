<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Scraper Tool</title>
  <link rel="stylesheet" href="styles/popup.css">
</head>
<body>
  <!-- Custom Modal for Method Selection -->
  <div class="modal-overlay" id="methodModal">
    <div class="modal">
      <div class="modal-header">
        <span>ğŸš€</span>
        <h3>Chá»n phÆ°Æ¡ng thá»©c scrape</h3>
      </div>
      <div class="modal-body">
        <p>Vui lÃ²ng chá»n phÆ°Æ¡ng thá»©c Ä‘á»ƒ scrape danh sÃ¡ch sáº£n pháº©m:</p>
        <div class="modal-options">
          <div class="modal-option" data-method="scroll">
            <div class="modal-option-icon">ğŸ“Š</div>
            <div class="modal-option-content">
              <div class="modal-option-title">Scroll</div>
              <div class="modal-option-desc">Tá»± Ä‘á»™ng scroll vÃ  click nÃºt "Xem thÃªm" Ä‘á»ƒ load thÃªm sáº£n pháº©m</div>
            </div>
            <div class="modal-option-check">âœ“</div>
          </div>
          <div class="modal-option" data-method="pagination">
            <div class="modal-option-icon">ğŸ“„</div>
            <div class="modal-option-content">
              <div class="modal-option-title">Pagination</div>
              <div class="modal-option-desc">Tá»± Ä‘á»™ng chuyá»ƒn trang báº±ng nÃºt "Trang sau" hoáº·c sá»‘ trang</div>
            </div>
            <div class="modal-option-check">âœ“</div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn modal-btn-cancel" id="modalCancel">Há»§y</button>
        <button class="modal-btn modal-btn-confirm" id="modalConfirm">Tiáº¿p tá»¥c</button>
      </div>
    </div>
  </div>
  <div class="container">
    <div class="header">
      <h1 style="display: flex; align-items: center; gap: 10px; justify-content: center;"><img src="icons/icon.png" alt="Data Scraper" style="width: 24px; height: 24px;"> Data Scraper</h1>
      <div class="subtitle">CÃ´ng cá»¥ scrape vÃ  export dá»¯ liá»‡u</div>
    </div>

    <div class="page-info" id="pageInfo">
      <div class="url">Äang táº£i...</div>
    </div>

    <!-- Results Modal (shows after scraping completes) -->
    <div class="modal-overlay" id="resultsModal" style="display: none;">
      <div class="modal" style="max-width: 500px; max-height: 90vh; overflow-y: auto;">
        <div class="modal-header">
          <span>ğŸ“Š</span>
          <h3>Káº¿t quáº£ scrape</h3>
          <button class="modal-close" id="closeResultsModal" style="position: absolute; right: 15px; top: 15px; background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
        </div>
        <div class="modal-body">
          <div class="stats" id="stats"></div>
          <div class="result" id="resultPreview" style="max-height: 300px; overflow-y: auto;"></div>
        </div>
        <div class="modal-footer" style="display: flex; gap: 10px; flex-wrap: wrap;">
          <button class="btn btn-success" id="exportJSON" style="flex: 1; min-width: 120px;">
            ğŸ’¾ Export JSON
          </button>
          <button class="btn btn-success" id="exportCSV" style="flex: 1; min-width: 120px;">
            ğŸ“„ Export CSV
          </button>
          <button class="btn btn-secondary" id="clearResults" style="flex: 1; min-width: 120px;">
            ğŸ—‘ï¸ XÃ³a káº¿t quáº£
          </button>
        </div>
      </div>
    </div>

    <!-- Export Format Selection Modal -->
    <div class="modal-overlay" id="exportFormatModal" style="display: none;">
      <div class="modal" style="max-width: 400px;">
        <div class="modal-header">
          <span>ğŸ’¾</span>
          <h3>Chá»n Ä‘á»‹nh dáº¡ng export</h3>
        </div>
        <div class="modal-body">
          <p style="margin-bottom: 15px;">Vui lÃ²ng chá»n Ä‘á»‹nh dáº¡ng file báº¡n muá»‘n export:</p>
          <div class="modal-options">
            <div class="modal-option" data-format="csv" style="cursor: pointer;">
              <div class="modal-option-icon">ğŸ“„</div>
              <div class="modal-option-content">
                <div class="modal-option-title">CSV (Máº·c Ä‘á»‹nh)</div>
                <div class="modal-option-desc">Äá»‹nh dáº¡ng báº£ng tÃ­nh, dá»… má»Ÿ báº±ng Excel</div>
              </div>
              <div class="modal-option-check">âœ“</div>
            </div>
            <div class="modal-option" data-format="json" style="cursor: pointer;">
              <div class="modal-option-icon">ğŸ’¾</div>
              <div class="modal-option-content">
                <div class="modal-option-title">JSON</div>
                <div class="modal-option-desc">Äá»‹nh dáº¡ng dá»¯ liá»‡u cÃ³ cáº¥u trÃºc, dá»… xá»­ lÃ½</div>
              </div>
              <div class="modal-option-check">âœ“</div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="modal-btn modal-btn-cancel" id="cancelExportFormat">Há»§y</button>
          <button class="modal-btn modal-btn-confirm" id="confirmExportFormat">Export</button>
        </div>
      </div>
    </div>

    <!-- Export Complete Modal -->
    <div class="modal-overlay" id="exportCompleteModal" style="display: none;">
      <div class="modal" style="max-width: 500px;">
        <div class="modal-header">
          <span>âœ…</span>
          <h3>Export hoÃ n táº¥t</h3>
        </div>
        <div class="modal-body">
          <div id="exportCompleteInfo" style="line-height: 1.8;">
            <!-- Will be filled dynamically -->
          </div>
        </div>
        <div class="modal-footer">
          <button class="modal-btn modal-btn-confirm" id="closeExportComplete">ÄÃ³ng</button>
        </div>
      </div>
    </div>

    <!-- Results Section (hidden, kept for backward compatibility) -->
    <div class="section" id="resultsSection" style="display: none;">
      <div class="section-title">ğŸ“Š Káº¿t quáº£</div>
      <div class="stats" id="statsOld"></div>
      <div class="result" id="resultPreviewOld"></div>
    </div>

    <!-- Message (at top, always visible) -->
    <div id="message"></div>

    <div class="tabs">
      <button class="tab active" data-tab="general">ğŸŒ General</button>
      <button class="tab" data-tab="longchau">ğŸ¥ Long ChÃ¢u</button>
    </div>

    <!-- General Tab - DÃ¹ng cho má»i trang web -->
    <div class="tab-content active" id="generalTab">
      <div class="section">
        <div class="section-title">ğŸŒ Scrape chung (DÃ¹ng cho má»i trang web)</div>
        <div style="margin-bottom: 15px; padding: 10px; background: #e3f2fd; border-radius: 6px; font-size: 11px; color: #1976d2;">
          ğŸ’¡ <strong>General:</strong> CÃ¡c tÃ­nh nÄƒng nÃ y hoáº¡t Ä‘á»™ng trÃªn má»i trang web cÃ³ báº£ng dá»¯ liá»‡u, links, hÃ¬nh áº£nh.
        </div>
        
        <div class="section-title" style="font-size: 13px; margin-top: 15px;">ğŸ“‹ Scrape nhanh</div>
        <button class="btn btn-primary" id="scrapeTable">
          ğŸ“Š Scrape Table
        </button>
        <button class="btn btn-primary" id="scrapeLinks">
          ğŸ”— Scrape Links
        </button>
        <button class="btn btn-primary" id="scrapeImages">
          ğŸ–¼ï¸ Scrape Images
        </button>

        <div class="section-title" style="font-size: 13px; margin-top: 20px;">ğŸ¯ Scrape tÃ¹y chá»‰nh</div>
        <div class="input-group">
          <label>CSS Selector:</label>
          <input type="text" id="customSelector" placeholder=".product, #content, h1, etc.">
        </div>
        <div class="input-group">
          <label>Láº¥y thuá»™c tÃ­nh (tÃ¹y chá»n):</label>
          <input type="text" id="customAttribute" placeholder="href, src, data-id, etc.">
        </div>
        <button class="btn btn-primary" id="scrapeCustom">
          ğŸ¯ Scrape
        </button>
        <button class="btn btn-secondary" id="highlightSelector">
          ğŸ” Highlight Elements
        </button>
      </div>
    </div>

    <!-- Long ChÃ¢u Tab - Specific cho Long ChÃ¢u -->
    <div class="tab-content" id="longchauTab">
      <div class="section">
        <div class="section-title">ğŸ¥ Scrape sáº£n pháº©m Long ChÃ¢u</div>
        <div style="margin-bottom: 15px; padding: 10px; background: #fff3e0; border-radius: 6px; font-size: 11px; color: #e65100;">
          ğŸ¥ <strong>Long ChÃ¢u Specific:</strong> CÃ¡c tÃ­nh nÄƒng nÃ y Ä‘Æ°á»£c tá»‘i Æ°u Ä‘áº·c biá»‡t cho website Long ChÃ¢u (nhathuoclongchau.com).
        </div>
        
        <!-- Processing Status -->
        <div id="processingStatus" style="display: none;">
          <div class="processing-title">ğŸ”„ Äang xá»­ lÃ½:</div>
          <div id="processingText">Chuáº©n bá»‹...</div>
        </div>
        
        <div class="section-title" style="font-size: 13px; margin-top: 15px;">ğŸ›ï¸ Scrape danh sÃ¡ch sáº£n pháº©m</div>
        
        <button class="btn btn-primary" id="scrapeProducts" style="margin-bottom: 15px;">
          ğŸ›ï¸ Scrape Products (ÄÆ¡n giáº£n)
        </button>
        
        <div class="input-group">
          <label>Skip sáº£n pháº©m Ä‘áº§u tiÃªn (bá» qua N sáº£n pháº©m Ä‘áº§u):</label>
          <input type="number" id="skipProducts" value="0" min="0" max="1000" placeholder="0">
          <div style="font-size: 11px; color: #666; margin-top: 5px;">
            ğŸ’¡ VÃ­ dá»¥: Skip 50, Get 100 â†’ sáº½ láº¥y sáº£n pháº©m thá»© 51-151
          </div>
        </div>
        <div class="input-group">
          <label>Sá»‘ lÆ°á»£ng sáº£n pháº©m cáº§n scrape:</label>
          <input type="number" id="maxProducts" value="100" min="1" max="1000">
        </div>
        <div class="input-group" style="margin-top: 10px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="autoExportCSV" style="width: 18px; height: 18px; cursor: pointer;">
            <span style="font-size: 13px;">Tá»± Ä‘á»™ng export sau khi scrape xong (tá»± Ä‘á»™ng chia file náº¿u >100 items)</span>
          </label>
        </div>
        <div class="input-group">
          <label>Container (Ä‘á»ƒ trá»‘ng Ä‘á»ƒ tá»± Ä‘á»™ng tÃ¬m):</label>
          <input type="text" id="containerSelector" placeholder=".grid, .product-list, etc." value=".grid.grid-cols-2">
        </div>
        <div class="input-group">
          <label>CSS Selector sáº£n pháº©m (Ä‘á»ƒ trá»‘ng Ä‘á»ƒ tá»± Ä‘á»™ng tÃ¬m):</label>
          <div style="display: flex; gap: 5px;">
            <input type="text" id="productSelector" placeholder="a[href*='.html'], > *, etc." style="flex: 1;">
            <button class="btn btn-secondary" id="autoDetectSelector" style="width: auto; padding: 10px 15px; margin: 0;">
              ğŸ” Tá»± Ä‘á»™ng
            </button>
            <button class="btn btn-secondary" id="testSelector" style="width: auto; padding: 10px 15px; margin: 0;">
              ğŸ‘ï¸ Test
            </button>
          </div>
          <div id="selectorInfo" style="margin-top: 5px; font-size: 11px; color: #666;"></div>
        </div>
        <div style="display: flex; gap: 5px;">
          <button class="btn btn-primary" id="scrapeManyProducts" style="flex: 1;">
            ğŸ“Š Scrape (Scroll)
          </button>
          <button class="btn btn-primary" id="scrapeWithPagination" style="flex: 1; background: #4CAF50;">
            ğŸ“„ Scrape (Pagination)
          </button>
        </div>
        <button class="btn btn-primary" id="scrapeListAndDetails" style="margin-top: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); width: 100%;">
          ğŸš€ Scrape List + Detail (1 Click)
        </button>
        <div style="font-size: 11px; color: #666; margin-top: 5px; padding: 8px; background: #f0f0f0; border-radius: 4px;">
          ğŸ’¡ <strong>1 Click:</strong> Tá»± Ä‘á»™ng scrape danh sÃ¡ch sáº£n pháº©m, sau Ä‘Ã³ tá»± Ä‘á»™ng scrape chi tiáº¿t tá»« cÃ¡c link Ä‘Ã£ láº¥y. Tiá»‡n lá»£i vÃ  nhanh chÃ³ng!
        </div>
        <div class="input-group" style="margin-top: 10px;">
          <label>Load More Button Selector (cho scroll, Ä‘á»ƒ trá»‘ng Ä‘á»ƒ tá»± Ä‘á»™ng tÃ¬m):</label>
          <input type="text" id="loadMoreSelector" placeholder="button:contains('Xem thÃªm'), .load-more, etc.">
        </div>
        <div class="input-group" style="margin-top: 10px;">
          <label>Next Page Selector (cho pagination, Ä‘á»ƒ trá»‘ng Ä‘á»ƒ tá»± Ä‘á»™ng tÃ¬m):</label>
          <input type="text" id="nextPageSelector" placeholder="a[href*='page='], .next, etc.">
        </div>
        <div class="input-group" style="margin-top: 15px;">
          <label>Scrape chi tiáº¿t sáº£n pháº©m:</label>
        </div>
        <div class="input-group" style="margin-top: 10px;">
          <label>
            <input type="checkbox" id="forceAPIScraping" style="margin-right: 5px;">
            Æ¯u tiÃªn scrape tá»« API (thay vÃ¬ DOM)
          </label>
          <div style="font-size: 11px; color: #666; margin-top: 5px;">
            ğŸ’¡ Náº¿u báº­t, sáº½ cá»‘ gáº¯ng scrape tá»« API trÆ°á»›c, chá»‰ fallback vá» DOM náº¿u API tháº¥t báº¡i
          </div>
        </div>
        <button class="btn btn-primary" id="scrapeProductDetail">
          ğŸ” Scrape Chi Tiáº¿t (Trang hiá»‡n táº¡i)
        </button>
        <button class="btn btn-primary" id="scrapeDetailsFromList" style="background: #FF9800;">
          ğŸ“‹ Scrape Chi Tiáº¿t Tá»« List (ÄÃ£ scrape)
        </button>
        <div style="margin-top: 20px; border-top: 1px solid #e0e0e0; padding-top: 15px;">
          <div class="section-title" style="font-size: 13px;">ğŸŒ Scrape tá»« API Long ChÃ¢u (Khuyáº¿n nghá»‹)</div>
          <div style="margin-bottom: 10px; padding: 8px; background: #e8f5e9; border-radius: 6px; font-size: 11px; color: #2e7d32;">
            âœ… <strong>Æ¯u Ä‘iá»ƒm API:</strong> Dá»¯ liá»‡u chÃ­nh xÃ¡c 100%, nhanh hÆ¡n, Ä‘áº§y Ä‘á»§ thÃ´ng tin tá»« API Long ChÃ¢u
          </div>
          <div class="input-group">
            <label>Category (tá»± Ä‘á»™ng detect tá»« URL náº¿u Ä‘á»ƒ trá»‘ng):</label>
            <input type="text" id="apiCategory" placeholder="thuc-pham-chuc-nang, duoc-my-pham, thuoc">
          </div>
          <button class="btn btn-primary" id="scrapeLongChauAPI" style="background: #2196F3; margin-bottom: 10px;">
            ğŸ¥ Scrape tá»« Long ChÃ¢u API
          </button>
          <div class="input-group" style="margin-top: 10px;">
            <label>API URL khÃ¡c (tÃ¹y chá»n, Ä‘á»ƒ trá»‘ng Ä‘á»ƒ tá»± Ä‘á»™ng intercept):</label>
            <input type="text" id="apiUrl" placeholder="https://api.example.com/products hoáº·c Ä‘á»ƒ trá»‘ng">
          </div>
          <button class="btn btn-primary" id="scrapeFromAPI" style="background: #4CAF50;">
            ğŸŒ Scrape tá»« API khÃ¡c
          </button>
        </div>
        <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 6px; font-size: 11px; color: #856404;">
          ğŸ’¡ <strong>LÆ°u Ã½:</strong> 
          <ul style="margin: 5px 0 0 20px; padding: 0;">
            <li>Scrape nhiá»u sáº£n pháº©m sáº½ tá»± Ä‘á»™ng scroll hoáº·c chuyá»ƒn trang Ä‘á»ƒ táº£i thÃªm sáº£n pháº©m</li>
            <li>Scrape chi tiáº¿t chá»‰ hoáº¡t Ä‘á»™ng trÃªn trang chi tiáº¿t sáº£n pháº©m Long ChÃ¢u</li>
            <li>NÃªn dÃ¹ng API scraping Ä‘á»ƒ cÃ³ dá»¯ liá»‡u chÃ­nh xÃ¡c vÃ  nhanh nháº¥t</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Load modules in order -->
  <script src="ui/popup-state.js"></script>
  <script src="ui/popup-display.js"></script>
  <script src="ui/popup-scrape.js"></script>
  <script src="core/scrape-workflow.js"></script>
  <script src="handlers/export-handler.js"></script>
  <script src="handlers/generic-handlers.js"></script>
  <script src="handlers/ecommerce-handlers.js"></script>
  <script src="popup-main.js"></script>
</body>
</html>

